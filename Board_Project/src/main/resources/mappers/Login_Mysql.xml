<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gyu.portfolio.service.mapper.LoginMapper">
	
	<resultMap id="loginVO" type="loginVO">
		<result property="userSeq"	column="USER_SEQ"	/>
		<result property="userId"	column="USER_ID" 	/>
		<result property="userPwd"	column="USER_PWD" 	/>
		<result property="userNm"	column="USER_NM" 	/>
		<result property="userSe"	column="USER_SE" 	/>
		
		<result property="fileNm"		column="FILE_NM" 	  />
		<result property="fileExt"		column="FILE_EXT" 	  />
		<result property="fileSz"		column="FILE_SZ" 	  />
		<result property="filePath"		column="FILE_PATH" 	  />
		<result property="strgFileNm"	column="STRG_FILE_NM" />
		
		<result property="stat"		column="STAT" 		/>
		<result property="inputPwd"	column="INPUT_PWD" 	/>
	</resultMap>
	
	
	<!-- 계정 상세조회 -->
	<select id="getLogin" resultMap="loginVO">
		SELECT
			USER_SEQ
			, USER_ID
			, USER_PWD
			, SHA2(#{userPwd}, 256) INPUT_PWD
			, USER_NM
			, USER_SE
			, STAT
		FROM TB_USER
		WHERE 1=1
			AND USER_ID = #{userId}
	</select>
	
	<!-- 계정 상세조회 -->
	<select id="getUserInfo" resultMap="loginVO">
		SELECT
			USER_SEQ
			, USER_ID
			, USER_NM
			, USER_SE
			, STAT
			, (SELECT FILE_PATH FROM TB_ATTACH WHERE BOARD_SEQ = 0 AND STAT = 1 AND REG_NO = T1.USER_SEQ) FILE_PATH
			, (SELECT STRG_FILE_NM FROM TB_ATTACH WHERE BOARD_SEQ = 0 AND  STAT = 1 AND REG_NO = T1.USER_SEQ) STRG_FILE_NM
		FROM TB_USER T1
		WHERE 1=1
			AND USER_SEQ = #{userSeq}
	</select>
	
	<!-- 계정 등록 -->
	<insert id="addLogin">
		INSERT INTO TB_USER(
			USER_ID
			, USER_PWD
			, USER_NM
			, USER_SE
			, STAT
		)VALUES (
			#{userId}
			, SHA2(#{userPwd}, 256)
			, #{userNm}
			, #{userSe}
			, 1
		)
	</insert>
	
	<!-- 계정 수정 -->
	<update id="updateLogin">
		UPDATE
			TB_USER
		SET
			USER_NM	= #{userNm}
		<if test="userPwd != null and userPwd != ''">
			, USER_PWD	= SHA2(#{userPwd}, 256)
		</if>
		WHERE 1=1
			AND USER_SEQ = #{userSeq}
	</update>
	
</mapper>